<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChatSpheres Recording</title>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
    }
    
    /* Embed container - fills entire viewport/iframe */
    .embed-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100vw;
      height: 100vh;
      background: #000;
      overflow: hidden;
    }
    
    /* Video wrapper - fills entire container */
    .video-wrapper {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
    }
    
    /* Video element - fills container */
    video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100% !important;
      height: 100% !important;
      object-fit: contain;
      background: #000;
    }
    
    /* For cover mode (no black bars, crops to fill) */
    .cover-mode video {
      object-fit: cover !important;
    }
    
    /* Fill mode - stretches video to fill (may distort) */
    .fill-mode video {
      object-fit: fill !important;
    }
    
    /* Loading state */
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 14px;
      text-align: center;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top-color: #FFD166;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Error state */
    .error {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 14px;
      text-align: center;
      padding: 20px;
    }
    
    .error-icon {
      font-size: 40px;
      margin-bottom: 10px;
    }
    
    /* Branding watermark (optional) */
    .watermark {
      position: absolute;
      bottom: 10px;
      right: 10px;
      opacity: 0.7;
      pointer-events: none;
      display: flex;
      align-items: center;
      gap: 5px;
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 12px;
      font-weight: 600;
      text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }
    
    .watermark svg {
      width: 20px;
      height: 20px;
    }
    
    .watermark.hidden {
      display: none;
    }
    
    /* Controls overlay */
    .controls-hint {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255,255,255,0.8);
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }
    
    .embed-container:hover .controls-hint {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="embed-container" id="embed-container">
    <!-- Loading state -->
    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <div>Loading recording...</div>
    </div>
    
    <!-- Error state (hidden by default) -->
    <div class="error" id="error" style="display: none;">
      <div class="error-icon">ðŸ˜¿</div>
      <div>Recording not available</div>
    </div>
    
    <!-- Video wrapper -->
    <div class="video-wrapper" id="video-wrapper" style="display: none;">
      <video id="video" controls playsinline>
        Your browser does not support the video tag.
      </video>
      
      <!-- Watermark (can be hidden with ?watermark=false) -->
      <div class="watermark" id="watermark">
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="24" cy="32" r="18" stroke="#fff" stroke-width="3" fill="none"/>
          <circle cx="40" cy="32" r="18" stroke="#fff" stroke-width="3" fill="none"/>
        </svg>
        <span>ChatSpheres</span>
      </div>
    </div>
    
    <div class="controls-hint">Click to play â€¢ Double-click for fullscreen</div>
  </div>

  <script>
    // Parse URL parameters
    const params = new URLSearchParams(window.location.search);
    const videoUrl = params.get('url') || params.get('src');
    const recordingId = params.get('id');
    const mode = params.get('mode') || 'contain'; // 'contain' or 'cover'
    const showWatermark = params.get('watermark') !== 'false';
    const autoplay = params.get('autoplay') === 'true';
    const muted = params.get('muted') === 'true' || autoplay;
    const loop = params.get('loop') === 'true';
    
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const videoWrapper = document.getElementById('video-wrapper');
    const video = document.getElementById('video');
    const watermark = document.getElementById('watermark');
    const container = document.getElementById('embed-container');
    
    // Apply mode
    if (mode === 'cover') {
      container.classList.add('cover-mode');
    } else if (mode === 'fill') {
      container.classList.add('fill-mode');
    }
    
    // Apply watermark visibility
    if (!showWatermark) {
      watermark.classList.add('hidden');
    }
    
    // Load video
    async function loadVideo() {
      let url = videoUrl;
      
      // If only recordingId provided, try to fetch URL from Firebase
      if (!url && recordingId) {
        try {
          // This would need to fetch from your recordings database
          // For now, show error if no direct URL
          throw new Error('Recording ID lookup not implemented');
        } catch (e) {
          showError();
          return;
        }
      }
      
      if (!url) {
        showError();
        return;
      }
      
      // Set video source
      video.src = url;
      
      // Apply settings
      if (autoplay) video.autoplay = true;
      if (muted) video.muted = true;
      if (loop) video.loop = true;
      
      // Handle video load
      video.addEventListener('loadeddata', () => {
        loading.style.display = 'none';
        videoWrapper.style.display = 'block';
      });
      
      video.addEventListener('error', () => {
        showError();
      });
      
      // Double-click for fullscreen
      video.addEventListener('dblclick', () => {
        if (video.requestFullscreen) {
          video.requestFullscreen();
        } else if (video.webkitRequestFullscreen) {
          video.webkitRequestFullscreen();
        }
      });
    }
    
    function showError() {
      loading.style.display = 'none';
      error.style.display = 'block';
    }
    
    // Initialize
    loadVideo();
  </script>
</body>
</html>
