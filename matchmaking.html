<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tivoq - Find Your Match</title>
  <meta name="description" content="Type what's on your mind and find someone to talk about it. AI-powered semantic matchmaking for meaningful conversations.">
  
  <!-- Monetag ads loaded dynamically by ads.js after subscription check -->

  <!-- Google AdSense - Commented out, using Monetag instead
  -->

  <!-- Monetag ads are loaded dynamically by /assets/js/ads.js after checking subscription status -->
  
  <!-- Firebase SDKs (same as main app) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  
  <!-- Supabase SDK for auth -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Load config from Netlify function -->
  <script>
    window.__CHATSPHERES_CONFIG__ = window.__CHATSPHERES_CONFIG__ || {};
  </script>
  <script src="/.netlify/functions/client-config"></script>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Brand CSS -->
  <link rel="stylesheet" href="/assets/css/brand.css?v=3">
  
  <!-- Ads CSS -->
  <link rel="stylesheet" href="/assets/css/ads.css?v=8">
  
  <!-- Favicon (vesica piscis) -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='24' cy='32' r='18' stroke='%23e63946' stroke-width='4' fill='none'/%3E%3Ccircle cx='40' cy='32' r='18' stroke='%23e63946' stroke-width='4' fill='none'/%3E%3C/svg%3E">
  
  <style>
    /* Page-specific styles */
    
    /* Shake animation for invalid input */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }
    .shake {
      animation: shake 0.4s ease;
    }
    
    /* Main Container */
    .matchmaking-main {
      min-height: calc(100vh - var(--header-height));
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: var(--space-xl) var(--space-lg);
      position: relative;
      z-index: 1;
    }
    
    /* Screen states */
    #input-screen { display: block; }
    #scanning-screen { display: none; }
    #match-screen { display: none; }
    
    /* Input Screen */
    .input-screen {
      text-align: center;
      max-width: 700px;
      width: 100%;
      animation: fadeInUp 0.6s ease-out;
    }
    
    .main-question {
      font-size: 2.5rem;
      font-weight: var(--font-weight-extrabold);
      color: var(--charcoal);
      margin-bottom: var(--space-sm);
      line-height: 1.2;
    }
    
    .sub-question {
      font-size: 1.1rem;
      color: var(--charcoal);
      opacity: 0.7;
      margin-bottom: var(--space-2xl);
    }
    
    /* Topic Input */
    .input-wrapper {
      position: relative;
      margin-bottom: var(--space-lg);
    }
    
    .topic-input {
      width: 100%;
      padding: 1.25rem 1.75rem;
      font-size: 1.2rem;
      font-family: var(--font-family);
      border: 3px solid var(--rose);
      border-radius: var(--radius-xl);
      background: var(--light-rose);
      color: var(--charcoal);
      outline: none;
      transition: all var(--transition-normal);
    }
    
    .topic-input::placeholder {
      color: var(--charcoal);
      opacity: 0.5;
    }
    
    .topic-input:focus {
      border-color: var(--gold);
      background: var(--bg-main);
      box-shadow: var(--shadow-glow-gold);
    }
    
    /* Submit Button */
    .submit-btn {
      background: var(--gold);
      color: var(--charcoal);
      border: none;
      border-radius: var(--radius-full);
      padding: 1rem 3rem;
      font-size: 1.1rem;
      font-weight: var(--font-weight-bold);
      font-family: var(--font-family);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: inline-flex;
      align-items: center;
      gap: var(--space-sm);
      box-shadow: var(--shadow-glow-gold);
    }
    
    .submit-btn:hover {
      background: var(--main-red);
      color: var(--light-rose);
      transform: scale(1.02);
      box-shadow: var(--shadow-glow-red);
    }
    
    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Trending Section */
    .trending-section {
      margin-top: var(--space-2xl);
    }
    
    .trending-label {
      font-size: 0.85rem;
      font-weight: var(--font-weight-bold);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--charcoal);
      opacity: 0.6;
      margin-bottom: var(--space-md);
    }
    
    .trending-chips {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: var(--space-sm);
    }
    
    .chip {
      display: inline-flex;
      padding: var(--space-sm) 1.25rem;
      border-radius: var(--radius-full);
      font-size: 0.9rem;
      font-weight: var(--font-weight-bold);
      font-family: var(--font-family);
      background: var(--light-rose);
      color: var(--charcoal);
      border: 2px solid transparent;
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    
    .chip:hover {
      background: var(--gold);
      border-color: var(--gold);
      transform: translateY(-2px);
    }
    
    .chip.selected {
      background: var(--main-red);
      color: var(--light-rose);
      border-color: var(--main-red);
    }
    
    /* Mode Section */
    .mode-section {
      margin-top: var(--space-xl);
      padding-top: var(--space-xl);
      border-top: 2px solid var(--rose);
    }
    
    .mode-label {
      font-size: 0.85rem;
      font-weight: var(--font-weight-bold);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--charcoal);
      opacity: 0.6;
      margin-bottom: var(--space-md);
    }
    
    .mode-buttons {
      display: flex;
      justify-content: center;
      gap: var(--space-sm);
      flex-wrap: wrap;
    }
    
    .mode-btn {
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius-full);
      font-size: 0.95rem;
      font-weight: var(--font-weight-bold);
      font-family: var(--font-family);
      background: var(--light-rose);
      color: var(--charcoal);
      border: 3px solid transparent;
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    
    .mode-btn:hover {
      border-color: var(--gold);
    }
    
    .mode-btn.active {
      background: var(--gold);
      border-color: var(--gold);
    }
    
    /* ========== SCANNING SCREEN ========== */
    .scanning-screen {
      display: none;
      text-align: center;
      max-width: 500px;
      width: 100%;
    }
    
    .scanning-screen.active {
      display: block;
      animation: fadeInUp 0.5s ease-out;
    }
    
    /* Radar Animation */
    .radar-container {
      width: 250px;
      height: 250px;
      margin: 0 auto var(--space-xl);
      position: relative;
    }
    
    .radar-circle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border-radius: 50%;
      border: 3px solid var(--main-red);
      opacity: 0;
      animation: radarPulse 2s ease-out infinite;
    }
    
    .radar-circle:nth-child(1) { width: 80px; height: 80px; animation-delay: 0s; }
    .radar-circle:nth-child(2) { width: 140px; height: 140px; animation-delay: 0.4s; }
    .radar-circle:nth-child(3) { width: 200px; height: 200px; animation-delay: 0.8s; }
    .radar-circle:nth-child(4) { width: 250px; height: 250px; animation-delay: 1.2s; }
    
    @keyframes radarPulse {
      0% { opacity: 0.8; transform: translate(-50%, -50%) scale(0.8); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(1.2); }
    }
    
    .radar-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      background: var(--gold);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: 0 0 30px rgba(255, 209, 102, 0.6);
      animation: centerPulse 1.5s ease-in-out infinite;
    }
    
    @keyframes centerPulse {
      0%, 100% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 30px rgba(255, 209, 102, 0.6); }
      50% { transform: translate(-50%, -50%) scale(1.1); box-shadow: 0 0 50px rgba(255, 209, 102, 0.8); }
    }
    
    .scanning-text {
      font-size: 1.5rem;
      font-weight: var(--font-weight-bold);
      color: var(--charcoal);
      margin-bottom: var(--space-sm);
    }
    
    .scanning-subtext {
      font-size: 1rem;
      color: var(--charcoal);
      opacity: 0.7;
      margin-bottom: var(--space-md);
    }
    
    .user-topic {
      display: inline-block;
      padding: var(--space-sm) 1.25rem;
      background: var(--light-rose);
      border-radius: var(--radius-full);
      font-weight: var(--font-weight-bold);
      color: var(--charcoal);
      margin-bottom: var(--space-lg);
    }
    
    .queue-status {
      font-size: 0.9rem;
      color: var(--charcoal);
      opacity: 0.6;
    }
    
    .cancel-btn {
      margin-top: var(--space-xl);
      padding: 0.75rem 2rem;
      border-radius: var(--radius-full);
      background: transparent;
      border: 2px solid var(--rose);
      color: var(--charcoal);
      font-weight: var(--font-weight-bold);
      font-size: 0.95rem;
      font-family: var(--font-family);
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    
    .cancel-btn:hover {
      background: var(--rose);
    }
    
    /* ========== MATCH FOUND SCREEN ========== */
    .match-screen {
      display: none;
      text-align: center;
      max-width: 550px;
      width: 100%;
    }
    
    .match-screen.active {
      display: block;
      animation: matchReveal 0.6s ease-out;
    }
    
    @keyframes matchReveal {
      0% { opacity: 0; transform: scale(0.8); }
      50% { transform: scale(1.05); }
      100% { opacity: 1; transform: scale(1); }
    }
    
    .match-celebration {
      font-size: 4rem;
      margin-bottom: var(--space-md);
      animation: bounce 0.6s ease infinite;
    }
    
    .match-title {
      font-size: 2rem;
      font-weight: var(--font-weight-extrabold);
      color: var(--main-red);
      margin-bottom: var(--space-lg);
    }
    
    .match-topics {
      background: var(--light-rose);
      border-radius: var(--radius-xl);
      padding: var(--space-lg);
      margin-bottom: var(--space-xl);
      border: 3px solid var(--rose);
    }
    
    .topic-comparison {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-md);
      flex-wrap: wrap;
    }
    
    .topic-item {
      padding: 0.75rem 1.25rem;
      background: var(--bg-main);
      border-radius: var(--radius-lg);
      font-weight: var(--font-weight-semibold);
      color: var(--charcoal);
      max-width: 200px;
    }
    
    .topic-item.yours {
      border: 2px solid var(--gold);
    }
    
    .topic-item.theirs {
      border: 2px solid var(--main-red);
    }
    
    .topic-item small {
      opacity: 0.7;
      display: block;
      margin-bottom: 4px;
    }
    
    .topic-connector {
      font-size: 1.5rem;
    }
    
    .similarity-badge {
      display: inline-block;
      padding: var(--space-sm) var(--space-md);
      background: var(--gold);
      border-radius: var(--radius-full);
      font-weight: var(--font-weight-bold);
      font-size: 0.9rem;
      color: var(--charcoal);
      margin-top: var(--space-md);
    }
    
    .connecting-text {
      font-size: 1.1rem;
      color: var(--charcoal);
      margin-bottom: var(--space-lg);
      animation: pulse 1s ease-in-out infinite;
    }
    
    .join-btn {
      background: var(--main-red);
      color: var(--light-rose);
      border: none;
      border-radius: var(--radius-full);
      padding: 1rem 3rem;
      font-size: 1.1rem;
      font-weight: var(--font-weight-bold);
      font-family: var(--font-family);
      cursor: pointer;
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-glow-red);
    }
    
    .join-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 30px rgba(230, 57, 70, 0.5);
    }
    
    /* ========== RATING MODAL ========== */
    .rating-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(34, 34, 59, 0.85);
      backdrop-filter: blur(8px);
      z-index: var(--z-modal);
      align-items: center;
      justify-content: center;
      padding: var(--space-md);
    }
    
    .rating-modal.active {
      display: flex;
    }
    
    .rating-content {
      background: var(--bg-main);
      border-radius: var(--radius-xl);
      padding: var(--space-2xl);
      max-width: 400px;
      width: 100%;
      text-align: center;
      animation: scaleIn 0.3s ease-out;
    }
    
    .rating-title {
      font-size: 1.5rem;
      font-weight: var(--font-weight-extrabold);
      color: var(--charcoal);
      margin-bottom: var(--space-sm);
    }
    
    .rating-subtitle {
      font-size: 1rem;
      color: var(--charcoal);
      opacity: 0.7;
      margin-bottom: var(--space-xl);
    }
    
    .rating-buttons {
      display: flex;
      justify-content: center;
      gap: var(--space-lg);
      margin-bottom: var(--space-lg);
    }
    
    .rate-btn {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid var(--rose);
      background: var(--light-rose);
      font-size: 2rem;
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    
    .rate-btn:hover {
      transform: scale(1.1);
    }
    
    .rate-btn.positive:hover {
      background: var(--gold);
      border-color: var(--gold);
    }
    
    .rate-btn.negative:hover {
      background: var(--rose);
      border-color: var(--main-red);
    }
    
    .skip-rating {
      background: none;
      border: none;
      color: var(--charcoal);
      opacity: 0.6;
      font-size: 0.9rem;
      font-family: var(--font-family);
      cursor: pointer;
      text-decoration: underline;
    }
    
    .skip-rating:hover {
      opacity: 1;
    }
    
    /* ========== AUTH MODAL ========== */
    .auth-modal {
      position: fixed;
      inset: 0;
      z-index: var(--z-max);
      display: none;
      align-items: center;
      justify-content: center;
      padding: var(--space-md);
      background: rgba(34, 34, 59, 0.9);
      backdrop-filter: blur(8px);
    }
    
    .auth-modal.active {
      display: flex;
    }
    
    .auth-modal-content {
      background: var(--light-rose);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      max-width: 400px;
      width: 100%;
      box-shadow: var(--shadow-lg);
      border: 4px solid var(--gold);
      position: relative;
      animation: scaleIn 0.3s ease-out;
    }
    
    .auth-modal-logo {
      text-align: center;
      margin-bottom: var(--space-lg);
    }
    
    .auth-modal-logo svg {
      width: 48px;
      height: 48px;
      margin: 0 auto var(--space-sm);
    }
    
    .auth-modal-logo h2 {
      font-size: 1.5rem;
      font-weight: var(--font-weight-bold);
      color: var(--charcoal);
      margin: 0;
    }
    
    .auth-modal-logo p {
      color: var(--charcoal);
      opacity: 0.7;
      font-size: 0.875rem;
      margin-top: var(--space-xs);
    }
    
    .auth-tabs {
      display: flex;
      margin-bottom: var(--space-lg);
      background: var(--rose);
      border-radius: var(--radius-full);
      padding: 4px;
    }
    
    .auth-tab {
      flex: 1;
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-full);
      font-weight: var(--font-weight-semibold);
      font-size: 0.875rem;
      font-family: var(--font-family);
      border: none;
      cursor: pointer;
      background: transparent;
      color: var(--charcoal);
      opacity: 0.7;
      transition: all var(--transition-fast);
    }
    
    .auth-tab.active {
      background: var(--main-red);
      color: var(--light-rose);
      opacity: 1;
    }
    
    .auth-message {
      margin-bottom: var(--space-md);
      padding: var(--space-sm);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      font-weight: var(--font-weight-medium);
      text-align: center;
    }
    
    .auth-message.error {
      background: var(--main-red);
      color: var(--light-rose);
    }
    
    .auth-message.success {
      background: var(--gold);
      color: var(--charcoal);
    }
    
    .auth-form {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }
    
    .auth-divider {
      display: flex;
      align-items: center;
      margin: var(--space-lg) 0;
    }
    
    .auth-divider::before,
    .auth-divider::after {
      content: '';
      flex: 1;
      border-top: 1px solid var(--rose);
    }
    
    .auth-divider span {
      padding: 0 var(--space-md);
      color: var(--charcoal);
      opacity: 0.6;
      font-size: 0.875rem;
    }
    
    .google-btn {
      width: 100%;
      padding: var(--space-md);
      background: var(--bg-main);
      border: 2px solid var(--rose);
      border-radius: var(--radius-lg);
      font-weight: var(--font-weight-semibold);
      font-family: var(--font-family);
      color: var(--charcoal);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
      transition: all var(--transition-fast);
    }
    
    .google-btn:hover {
      background: var(--rose);
      border-color: var(--main-red);
    }
    
    .auth-close {
      position: absolute;
      top: var(--space-md);
      right: var(--space-md);
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--charcoal);
      opacity: 0.5;
      line-height: 1;
      transition: opacity var(--transition-fast);
    }
    
    .auth-close:hover {
      opacity: 1;
    }
    
    /* ========== RESPONSIVE ========== */
    @media (max-width: 768px) {
      .main-question {
        font-size: 1.75rem;
      }
      
      .topic-input {
        padding: var(--space-md) 1.25rem;
        font-size: 1rem;
      }
      
      .trending-chips {
        gap: var(--space-xs);
      }
      
      .chip {
        padding: 0.4rem var(--space-md);
        font-size: 0.85rem;
      }
      
      .mode-buttons {
        gap: var(--space-xs);
      }
      
      .mode-btn {
        padding: 0.6rem 1.25rem;
        font-size: 0.9rem;
      }
      
      .radar-container {
        width: 200px;
        height: 200px;
      }
      
      .radar-circle:nth-child(1) { width: 60px; height: 60px; }
      .radar-circle:nth-child(2) { width: 110px; height: 110px; }
      .radar-circle:nth-child(3) { width: 160px; height: 160px; }
      .radar-circle:nth-child(4) { width: 200px; height: 200px; }
    }
  </style>
</head>
<body>
  <!-- Background Pattern -->
  <div class="bg-pattern"></div>
  
  <!-- Header -->
  <header class="site-header" style="position: relative; z-index: 500000;">
    <div class="header-container">
      <!-- Left side: Menu button -->
      <div class="header-left" style="display: flex; align-items: center; gap: var(--space-sm); z-index: 999999;">
        <button id="menu-toggle" class="menu-toggle" aria-label="Toggle menu" style="z-index: 999999; position: relative; pointer-events: auto;">
          <span class="menu-bar"></span>
          <span class="menu-bar"></span>
          <span class="menu-bar"></span>
        </button>
        <a href="/explore.html" class="site-logo">
          <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24" cy="32" r="20" stroke="#FCE2E5" stroke-width="6"/>
            <circle cx="40" cy="32" r="20" stroke="#FCE2E5" stroke-width="6"/>
            <circle cx="24" cy="32" r="18" stroke="#e63946" stroke-width="4" fill="none"/>
            <circle cx="40" cy="32" r="18" stroke="#e63946" stroke-width="4" fill="none"/>
          </svg>
          <span class="site-logo-text">Tivoq</span>
        </a>
      </div>
      <!-- Right side: Gem badge -->
      <div class="header-actions">
        <div id="header-gem-badge" class="header-gem-badge" style="display: none;" onclick="window.location.href='/cashout.html'" title="Your gems">
          <span>üíé</span>
          <span class="gem-count">0</span>
        </div>
      </div>
    </div>
  </header>
  
  <!-- Navigation Overlay -->
  <div id="nav-overlay" class="nav-overlay"></div>
  
  <!-- Navigation Menu -->
  <nav id="nav-menu" class="nav-menu">
    <button id="nav-close" class="nav-close" aria-label="Close menu"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
    <ul class="nav-links">
      <li><a href="/explore.html" class="nav-link"><span class="nav-link-icon">üè†</span> Home</a></li>
      <li><a href="/live.html" class="nav-link"><span class="nav-link-icon">üî¥</span> Live Rooms</a></li>
      <li><a href="/matchmaking.html" class="nav-link active"><span class="nav-link-icon">üéØ</span> Find Match</a></li>
      <li><a href="/forums" class="nav-link"><span class="nav-link-icon">üåê</span> Forums</a></li>
      <li><a href="/features.html" class="nav-link"><span class="nav-link-icon">‚ú®</span> Features</a></li>
      <li><a href="/creators.html" class="nav-link"><span class="nav-link-icon">üéôÔ∏è</span> For Creators</a></li>
      <li><a href="/recordings.html" class="nav-link"><span class="nav-link-icon">üìπ</span> Recordings</a></li>
      <li><a href="/pricing.html" class="nav-link"><span class="nav-link-icon">üíé</span> Pricing</a></li>
    </ul>
    
    <div class="nav-divider"></div>
    
    <ul class="nav-links">
      <li><a href="/about.html" class="nav-link"><span class="nav-link-icon">‚ÑπÔ∏è</span> About</a></li>
      <li><a href="#" class="nav-link" onclick="openFeedbackModal(); return false;"><span class="nav-link-icon">üí¨</span> Feedback</a></li>
      <li><a href="/explore.html" class="nav-link"><span class="nav-link-icon">üåê</span> Explore</a></li>
      <li><a href="/profile.html" class="nav-link"><span class="nav-link-icon">üë§</span> Profile</a></li>
      <li><a href="/cashout.html" class="nav-link"><span class="nav-link-icon">üí∞</span> Cash Out</a></li>
      <li><a href="/affiliate.html" class="nav-link"><span class="nav-link-icon">üîó</span> Affiliate</a></li>
      <li><a href="/branding.html" id="nav-branding-link" class="nav-link" style="display: none;"><span class="nav-link-icon">üé®</span> Branding</a></li>
    </ul>
    
    <!-- Guest Links -->
    <div id="nav-guest-links" class="nav-user-section">
      <button onclick="showAuthModalFromHeader()" class="btn btn-ghost btn-full" style="margin-bottom: var(--space-sm);">Sign In</button>
      <a href="/signup.html" class="btn btn-primary btn-full" style="text-decoration: none;">Sign Up</a>
    </div>
    
    <!-- User Section (shown when logged in) -->
    <div id="nav-user-section" class="nav-user-section" style="display: none;">
      <div class="nav-user-info">
        <div class="nav-user-avatar">üë§</div>
        <div class="nav-user-details">
          <div id="nav-user-name" class="nav-user-name">User</div>
          <div class="nav-user-gems">üíé <span id="nav-user-gems">0</span> gems</div>
        </div>
      </div>
      <button onclick="handleLogout()" class="btn btn-ghost btn-full">Sign Out</button>
    </div>
  </nav>
  
  <!-- Main Container -->
  <div class="page-wrapper">
    <main class="matchmaking-main">
      
      <!-- ========== INPUT SCREEN ========== -->
      <section id="input-screen" class="input-screen">
        <h1 class="main-question">What's on your mind?</h1>
        <p class="sub-question">Type a topic, find someone to talk about it</p>
        
        <div class="input-wrapper">
          <input 
            type="text" 
            id="topic-input" 
            class="topic-input" 
            placeholder="Star Wars, career advice, philosophy..."
            maxlength="200"
            autocomplete="off"
            autofocus
          >
        </div>
        
        <button id="submit-btn" class="submit-btn">
          <span>Find My Match</span>
          <span>‚Üí</span>
        </button>
        
        <!-- Trending Topics -->
        <div class="trending-section">
          <p class="trending-label">üî• Trending Now</p>
          <div class="trending-chips">
            <button class="chip" data-topic="Life advice and tough decisions">Life Advice</button>
            <button class="chip" data-topic="Technology and AI future">Tech & AI</button>
            <button class="chip" data-topic="Movies and TV shows">Movies & TV</button>
            <button class="chip" data-topic="Career and work life balance">Career Talk</button>
            <button class="chip" data-topic="Philosophy and meaning of life">Philosophy</button>
            <button class="chip" data-topic="Relationships and dating">Relationships</button>
          </div>
        </div>
        
        <!-- Mode Selector -->
        <div class="mode-section">
          <p class="mode-label">üí¨ Conversation Style</p>
          <div class="mode-buttons">
            <button class="mode-btn active" data-mode="casual">
              ‚òï Casual Chat
            </button>
            <button class="mode-btn" data-mode="debate">
              ‚öîÔ∏è Friendly Debate
            </button>
            <button class="mode-btn" data-mode="vent">
              üí≠ Vent Session
            </button>
          </div>
        </div>
        
        <!-- Ad below input area (user is deciding, not in a hurry) -->
        <div class="chatspheres-ad-container chatspheres-ad-inline" id="input-ad" style="margin-top: var(--space-xl);">
          <div class="monetag-ad-slot chatspheres-ad"
               style="display:block"
               
               data-ad-format="horizontal"
               </div>
        </div>
      </section>
      
      <!-- ========== SCANNING SCREEN ========== -->
      <section id="scanning-screen" class="scanning-screen">
        <!-- Radar Animation -->
        <div class="radar-container">
          <div class="radar-circle"></div>
          <div class="radar-circle"></div>
          <div class="radar-circle"></div>
          <div class="radar-circle"></div>
          <div class="radar-center">üîç</div>
        </div>
        
        <h2 class="scanning-text">Scanning the Sphere...</h2>
        <p class="scanning-subtext">Finding someone who wants to talk about</p>
        <div class="user-topic" id="user-topic-display">"Your topic"</div>
        <p class="queue-status" id="queue-status">Connecting to matchmaking...</p>
        
        <button id="cancel-btn" class="cancel-btn">Cancel Search</button>
        
        <!-- Ad shown while scanning (perfect timing - user is waiting) -->
        <div class="chatspheres-ad-container chatspheres-ad-inline" id="scanning-ad" style="margin-top: var(--space-xl);">
          <div class="monetag-ad-slot chatspheres-ad"
               style="display:block"
               
               data-ad-format="horizontal"
               </div>
        </div>
      </section>
      
      <!-- ========== MATCH FOUND SCREEN ========== -->
      <section id="match-screen" class="match-screen">
        <div class="match-celebration">üéâ</div>
        <h2 class="match-title">Match Found!</h2>
        
        <div class="match-topics">
          <div class="topic-comparison">
            <div class="topic-item yours">
              <small>You typed</small>
              <span id="match-your-topic">Your topic</span>
            </div>
            <span class="topic-connector">‚ÜîÔ∏è</span>
            <div class="topic-item theirs">
              <small>They typed</small>
              <span id="match-their-topic">Their topic</span>
            </div>
          </div>
          <div class="similarity-badge" id="similarity-badge">85% Match</div>
        </div>
        
        <p class="connecting-text">Get ready for a great conversation!</p>
        
        <button id="join-room-btn" class="join-btn">
          üöÄ Join Video Chat
        </button>
      </section>
      
      <!-- Ad Container (shown to non-ad-free users) -->
      <div class="chatspheres-ad-container chatspheres-ad-inline" id="matchmaking-ad">
        <div class="monetag-ad-slot chatspheres-ad"
             style="display:block"
             
             
             </div>
      </div>
      
      <!-- Footer -->
      <footer style="text-align: center; padding: var(--space-xl); color: var(--charcoal); font-size: 0.875rem; border-top: 2px solid var(--rose); margin-top: var(--space-2xl);">
        <p>
          <a href="/terms.html" style="color: var(--main-red);">Terms</a> ¬∑ 
          <a href="/privacy.html" style="color: var(--main-red);">Privacy</a> ¬∑ 
          <a href="/community-guidelines.html" style="color: var(--main-red);">Guidelines</a> ¬∑ 
          <a href="/contact.html" style="color: var(--main-red);">Contact</a>
        </p>
        <p style="margin-top: var(--space-sm); opacity: 0.7;">¬© 2025 Tivoq. All rights reserved.</p>
      </footer>
      
    </main>
  </div>
  
  <!-- ========== RATING MODAL ========== -->
  <div id="rating-modal" class="rating-modal">
    <div class="rating-content">
      <h3 class="rating-title">How was your chat?</h3>
      <p class="rating-subtitle">Your feedback helps us improve matches</p>
      
      <div class="rating-buttons">
        <button id="rate-positive" class="rate-btn positive" title="Good conversation">
          üëç
        </button>
        <button id="rate-negative" class="rate-btn negative" title="Could be better">
          üëé
        </button>
      </div>
      
      <button id="skip-rating" class="skip-rating">Skip for now</button>
    </div>
  </div>

  <!-- ========== AUTH MODAL ========== -->
  <div id="auth-modal" class="auth-modal">
    <div class="auth-modal-content">
      <!-- Logo -->
      <div class="auth-modal-logo">
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="24" cy="32" r="20" stroke="#FCE2E5" stroke-width="6"/>
          <circle cx="40" cy="32" r="20" stroke="#FCE2E5" stroke-width="6"/>
          <circle cx="24" cy="32" r="18" stroke="#e63946" stroke-width="4" fill="none"/>
          <circle cx="40" cy="32" r="18" stroke="#e63946" stroke-width="4" fill="none"/>
        </svg>
        <h2>Welcome to Tivoq</h2>
        <p>Sign in to find your match</p>
      </div>
      
      <!-- Error/Success Messages -->
      <div id="auth-message" class="auth-message hidden"></div>
      
      <!-- Sign In Form -->
      <form id="signin-form" class="auth-form" onsubmit="handleSignIn(event)">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" id="signin-email" class="form-input" required placeholder="you@example.com">
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" id="signin-password" class="form-input" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <button type="submit" class="btn btn-primary btn-full">Sign In</button>
      </form>
      
      <!-- Divider -->
      <div class="auth-divider">
        <span>or continue with</span>
      </div>
      
      <!-- Google Sign In -->
      <button onclick="handleGoogleSignIn()" class="google-btn">
        <svg width="20" height="20" viewBox="0 0 24 24">
          <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
          <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
          <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
          <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
        </svg>
        Continue with Google
      </button>
      
      <!-- Sign Up Link -->
      <p style="text-align: center; margin-top: var(--space-lg); color: var(--charcoal);">
        Don't have an account? 
        <a href="/signup.html" style="color: var(--main-red); font-weight: 700; text-decoration: underline;">Sign Up</a>
      </p>
      
      <!-- Close button -->
      <button onclick="hideAuthModal()" class="auth-close">√ó</button>
    </div>
  </div>
  
  <!-- Navigation Script -->
  <script src="/assets/js/navigation.js?v=2"></script>
  
  <!-- Moderation Script (pending ratings) -->
  <script src="/assets/js/moderation.js"></script>
  
  <!-- Matchmaking Scripts -->
  <script src="/assets/js/matchmaking.js"></script>
  
  <!-- Auth Script -->
  <script>
    // Supabase Auth for Matchmaking Page
    (function() {
      const runtimeConfig = window.__CHATSPHERES_CONFIG__ || {};
      const supabaseConfig = runtimeConfig.supabase || {};
      const authConfig = runtimeConfig.auth || {};
      
      const SUPABASE_URL = supabaseConfig.url || '';
      const SUPABASE_ANON_KEY = supabaseConfig.anonKey || '';
      const AUTH_COOKIE_DOMAIN = authConfig.cookieDomain || '.tivoq.com';
      const AUTH_SITE_URL = authConfig.siteUrl || window.location.origin;
      const AUTH_REDIRECT_URL = authConfig.redirectUrl || `${AUTH_SITE_URL}/.netlify/functions/auth-callback`;
      
      let supabaseClient = null;
      
      // Initialize Supabase
      if (window.supabase && window.supabase.createClient && SUPABASE_URL && SUPABASE_ANON_KEY) {
        try {
          supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
            auth: {
              persistSession: true,
              autoRefreshToken: true,
              detectSessionInUrl: true,
              flowType: 'pkce',
              storage: {
                getItem: (key) => {
                  const cookies = document.cookie.split(';');
                  for (const cookie of cookies) {
                    const [name, value] = cookie.trim().split('=');
                    if (name === key) return decodeURIComponent(value);
                  }
                  try { return localStorage.getItem(key); } catch(e) { return null; }
                },
                setItem: (key, value) => {
                  const maxAge = 60 * 60 * 24 * 365;
                  let cookieStr = `${key}=${encodeURIComponent(value)}; path=/; max-age=${maxAge}; SameSite=Lax`;
                  if (window.location.protocol === 'https:') cookieStr += '; Secure';
                  if (AUTH_COOKIE_DOMAIN !== 'localhost') cookieStr += `; domain=${AUTH_COOKIE_DOMAIN}`;
                  document.cookie = cookieStr;
                  try { localStorage.setItem(key, value); } catch(e) {}
                },
                removeItem: (key) => {
                  let cookieStr = `${key}=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT`;
                  if (AUTH_COOKIE_DOMAIN !== 'localhost') cookieStr += `; domain=${AUTH_COOKIE_DOMAIN}`;
                  document.cookie = cookieStr;
                  try { localStorage.removeItem(key); } catch(e) {}
                }
              }
            }
          });
          console.log('‚úÖ Supabase auth initialized on matchmaking page');
        } catch (e) {
          console.error('‚ùå Supabase init error:', e);
        }
      }
      
      // Handle auth callback hash (OAuth redirect)
      function handleAuthCallback() {
        if (window.location.hash.includes('auth-callback') || window.location.hash.includes('access_token')) {
          console.log('üîê Handling auth callback on matchmaking page...');
          // Clear the hash after processing
          setTimeout(() => {
            if (window.location.hash) {
              history.replaceState(null, '', window.location.pathname + window.location.search);
            }
          }, 100);
        }
      }
      
      // Check auth state on load
      async function checkAuthState() {
        if (!supabaseClient) return;
        
        // Handle auth callback if present
        handleAuthCallback();
        
        try {
          const { data: { session } } = await supabaseClient.auth.getSession();
          if (session?.user) {
            updateHeaderForUser(session.user);
          }
        } catch (e) {
          console.error('Auth check error:', e);
        }
        
        // Listen for auth changes
        supabaseClient.auth.onAuthStateChange(async (event, session) => {
          if (session?.user) {
            updateHeaderForUser(session.user);
            hideAuthModal();
            
            // Track referral signup if this is a new user
            if (event === 'SIGNED_IN') {
              // Use cross-domain referral tracking
              if (window.ChatSpheresReferral) {
                window.ChatSpheresReferral.trackReferralSignup(session.user.id);
              }
            }
          } else {
            updateHeaderForGuest();
          }
        });
        
        // Referral code tracking is now handled by /assets/js/referral.js
        // which uses cross-domain cookies for better tracking across subdomains
      }
      
      function updateHeaderForUser(user) {
        const guestLinks = document.getElementById('nav-guest-links');
        const userSection = document.getElementById('nav-user-section');
        const userName = document.getElementById('nav-user-name');
        const headerGemBadge = document.getElementById('header-gem-badge');
        
        if (guestLinks) guestLinks.style.display = 'none';
        if (userSection) userSection.style.display = 'block';
        if (headerGemBadge) headerGemBadge.style.display = 'flex';
        
        if (userName) {
          const name = user.user_metadata?.name || user.user_metadata?.full_name || user.email?.split('@')[0] || 'User';
          userName.textContent = name;
        }
        
        // Fetch and display gem balance
        fetchAndDisplayGemBalance(user.id);
      }
      
      async function fetchAndDisplayGemBalance(userId) {
        const gemCount = document.getElementById('header-gem-badge')?.querySelector('.gem-count');
        const navGems = document.getElementById('nav-user-gems');
        if (!userId) return;
        
        try {
          const response = await fetch(`/.netlify/functions/get-subscription?userId=${userId}`);
          if (!response.ok) return;
          
          const data = await response.json();
          const totalGems = data.totalGems || 0;
          
          if (gemCount) gemCount.textContent = totalGems.toLocaleString();
          if (navGems) navGems.textContent = totalGems.toLocaleString();
          console.log('üíé Gem balance loaded:', totalGems);
          
          // Show branding link for pro users
          const brandingLink = document.getElementById('nav-branding-link');
          if (brandingLink && data.limits?.canCustomBrand) {
            brandingLink.style.display = 'flex';
          }
        } catch (error) {
          console.error('‚ùå Error fetching gem balance:', error);
        }
      }
      
      function updateHeaderForGuest() {
        const guestLinks = document.getElementById('nav-guest-links');
        const userSection = document.getElementById('nav-user-section');
        const headerGemBadge = document.getElementById('header-gem-badge');
        
        if (guestLinks) guestLinks.style.display = 'block';
        if (userSection) userSection.style.display = 'none';
        if (headerGemBadge) headerGemBadge.style.display = 'none';
      }
      
      // Modal functions
      window.showAuthModalFromHeader = function(tab = 'signin') {
        const modal = document.getElementById('auth-modal');
        if (modal) {
          modal.classList.add('active');
          switchAuthTab(tab);
        }
      };
      
      window.hideAuthModal = function() {
        const modal = document.getElementById('auth-modal');
        if (modal) {
          modal.classList.remove('active');
        }
      };
      
      window.switchAuthTab = function(tab) {
        const signinTab = document.getElementById('auth-tab-signin');
        const signupTab = document.getElementById('auth-tab-signup');
        const signinForm = document.getElementById('signin-form');
        const signupForm = document.getElementById('signup-form');
        
        if (tab === 'signin') {
          signinTab.classList.add('active');
          signupTab.classList.remove('active');
          signinForm.classList.remove('hidden');
          signupForm.classList.add('hidden');
        } else {
          signupTab.classList.add('active');
          signinTab.classList.remove('active');
          signupForm.classList.remove('hidden');
          signinForm.classList.add('hidden');
        }
      };
      
      function showMessage(msg, isError = true) {
        const el = document.getElementById('auth-message');
        if (el) {
          el.textContent = msg;
          el.className = `auth-message ${isError ? 'error' : 'success'}`;
          el.classList.remove('hidden');
        }
      }
      
      window.handleSignIn = async function(e) {
        e.preventDefault();
        if (!supabaseClient) { showMessage('Auth unavailable'); return; }
        
        const email = document.getElementById('signin-email')?.value?.trim();
        const password = document.getElementById('signin-password')?.value;
        
        try {
          const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
          if (error) { showMessage(error.message); return; }
          showMessage('‚úÖ Signed in!', false);
          setTimeout(hideAuthModal, 500);
        } catch (e) {
          showMessage('Sign in failed');
        }
      };
      
      window.handleSignUp = async function(e) {
        e.preventDefault();
        if (!supabaseClient) { showMessage('Auth unavailable'); return; }
        
        const name = document.getElementById('signup-name')?.value?.trim();
        const email = document.getElementById('signup-email')?.value?.trim();
        const password = document.getElementById('signup-password')?.value;
        
        try {
          const { data, error } = await supabaseClient.auth.signUp({
            email, password,
            options: { data: { name, full_name: name }, emailRedirectTo: AUTH_REDIRECT_URL }
          });
          if (error) { showMessage(error.message); return; }
          if (data?.session) {
            showMessage('‚úÖ Account created!', false);
            setTimeout(hideAuthModal, 500);
          } else {
            showMessage('‚úÖ Check your email to confirm!', false);
          }
        } catch (e) {
          showMessage('Sign up failed');
        }
      };
      
      window.handleGoogleSignIn = async function() {
        if (!supabaseClient) { showMessage('Auth unavailable'); return; }
        
        try {
          await supabaseClient.auth.signInWithOAuth({
            provider: 'google',
            options: { redirectTo: AUTH_REDIRECT_URL }
          });
        } catch (e) {
          showMessage('Google sign in failed');
        }
      };
      
      window.handleLogout = async function() {
        if (!supabaseClient) return;
        try {
          await supabaseClient.auth.signOut();
          updateHeaderForGuest();
        } catch (e) {
          console.error('Logout error:', e);
        }
      };
      
      // Init on load
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkAuthState);
      } else {
        checkAuthState();
      }
    })();
  </script>
  
  <!-- Ad Management Script -->
  <script src="/assets/js/ads.js?v=6"></script>

  <!-- Monetag ads loaded dynamically by ads.js after subscription check -->
  
  <!-- Cross-Domain Referral Tracking -->
  <script src="/assets/js/referral.js"></script>
</body>
</html>
